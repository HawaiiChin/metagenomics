#QC&trimm by trimmometic
java -jar /gss1/home/zlcui/miniconda3/pkgs/trimmomatic-0.40-hdfd78af_0/share/trimmomatic-0.40-0/trimmomatic.jar PE -threads 6 -phred33 SRR18673647_1.fastq SRR18673647_2.fastq trimmomatic_pair/SRR18673647_1_paired.fastq SRR18673647_1_unpaired.fastq trimmomatic_pair/SRR18673647_2_paired.fastq SRR18673647_2_unpaired.fastq ILLUMINACLIP:TruSeq3-PE.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36

#assembly by megahit(most available threads 28)
tar zvxf MEGAHIT-1.2.9-Linux-x86_64-static.tar.gz
cd MEGAHIT-1.2.9-Linux-x86_64-static/bin
./megahit --test
./MEGAHIT-1.2.9-Linux-x86_64-static/bin/megahit -t 28 -1 trimmomatic_pair/SRR18673641_1_paired.fastq -2 trimmomatic_pair/SRR18673641_2_paired.fastq -o Megahit

#taxonomic assignment by kraken2
kraken2 --db /gss2/database/kraken2_dbs --threads 28 --unclassified-out megahit_out/krakenunc_40 --classified-out megahit_out/classifiedkraken_40 --report megahit_out/40report megahit_out/SRR18673640_contigs.fa

#prodigal for ORFs prediction
prodigal -i host_removal/nohost_SRR18673647_contigs.fasta -o prodigal/nohost_SRR18673647.genes -a prodigal/nohost_SRR18673647_proteins.faa -p met

#check protein no. in sample
to_pro=$(grep -c "^>" prodigal/nohost_SRR18673641_proteins.faa)
echo $to_pro

#binning by MetaBat2
metabat2 -i host_removal/nohost_SRR18673647_contigs.fasta -o binning -m 2000

#protein annotation by eggnog-mapper
source /gss1/env/eggnog-mapper.env
emapper.py -i prodigal/nohost_SRR18673645_proteins.faa --data_dir /gss1/App_dir/database/emapperdb-5.0.2 -o emap45 --cpu 28
